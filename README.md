# Hotel Mama

## Table of Contents
* [General Description](#General-Description)
* [Technical Background](#Technical-Background)
* [Installation](#Installation)
* [Major Challenges](#Major-Challenges)
* [Impressum](#Impressum)

## General Description
> Have you ever wondered what you can cook with what you currently have in your fridge?
Have you ever been to the supermarket and have completely forgotten what planned to buy?

Hotel Mama is a revolutionizing flask application that helps you to:

## Homepage
* The Homepage allows you to reach all functionalities of our website using the navigation bar
* Not only does it encompass an appealing user-interface, it can also be accessed on any device without any impairment regarding the interface quality
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Home1.PNG?raw=true)
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Home2.PNG?raw=true)
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Home3.PNG?raw=true)

## Cooker's Book
* In the cooker's book you can share your recipes with other users
* The featured posts also allow any user to directly access the user profile of whoever created the post to see more posts of that user in his personal Cooker's Chapter
* The tag link in every post allows you to access posts within the same category
* Lastly you can also like a post and if necessary unlike it again. It is however important that you can only like a post once.
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Cooker'sBook.png?raw=true)

## Upload Recipe
* Here you have the ability to upload personal recipes and include all relevant information (Title, time requirement, description and an image of the expected result)
* By submitting your post, it will be available to all other users in the Cooker's book and on your profile
* To manage your posts you can go to your profile page and delete posts or access them there if you intend to recook one of your recipes
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Upload.png?raw=true)

## Fridge Search
* The Fridge Search button allows you to search for recipes given the items from your digital fridge
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/FridgeSearch.png?raw=true)
* You can see the content of your fridge on your personal profile and also edit it
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Fridge_Profile.PNG?raw=true)

## Create Menu
* Here you can create a weekly menu based on your preferences (calories per day, allergies, diet, exclusion of specific products)
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/MenuCreator-Preferences.png?raw=true)
* You can add this menu plan that encompasses your whole week by one simple click on the "Save this Menu" button
* Additionally you can directly print this weekly menu or save it as PDF with a click on the "Print this Menu/Save PDF" button
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/MenuCreator-Results.png?raw=true)

## Fridge Manager
* The Fridge Manager provides you with three options to add products to your fridge
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/FridgeManager.PNG?raw=true)
* Add food that is in your fridge via image recognition by uploading a picture of a natural product in your fridge
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Vision.PNG?raw=true)
* Add food that is in your fridge via barcode scanning by uploading a picture of the packaged product's barcode
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Barcode.PNG?raw=true)
* Add food that is in your fridge to your digital fridge manually by typing in the relevant information
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Manualfridge.PNG?raw=true)

## Chatbot
* By using the Chatbot you can discover and save your favorite recipes via this very advanced application, additionally you can interact with the Chatbot by asking almost any other question. Check out this example where we asked for a random food trivia:
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Chatbot.png?raw=true)

## Posts/Recipes
* As you can tell there are multiple ways to access a recipe on the application
* Once you are on the recipe's page, you can add the recipe's ingredients to your grocery list through one click on the "Add to grocery list" button
* Additionally there is the possibility to print the recipe directly by clicking on the "Print this recipe" button
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Grocery_List_Profile.PNG?raw=true)

## Grocery list
* While the products added directly from the added recipes will already be in your grocery list, you can add items manually to your grocery list
* On your personal profile page you can also manage the grocery list manually and delete products off of the grocery list if necessary
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Custom_Grocery_List.PNG?raw=true)

## Personal Profile Page
* Here you can access all relevant information that is linked to your profile on our application
* You can set up your personal profile with your private information and get an overview of all your data
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/UserProfile.PNG?raw=true)
* Also you can manage your personal information and change it if necessary
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/ChangeProfile.PNG?raw=true)

## Weekly Menu
* On your profile you can also access and read the weekly Menu you saved:
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Menu_Profile.PNG?raw=true)

## Your Posts
* Also you can track, delete and like your own posts via your personal profile
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/MyPosts_Profile.PNG?raw=true)

Furthermore, Hotel Mama gives you insights into the most frequently cooked recipes, popular foods, and much more. It helps you get a better understanding of what is trending at the moment. For access to the Hotel Mamma application, users need to register. The functionalities are available only for members of the Hotel Mama community.



## Technical Background
Hotel Mama is already online as a web-app under [Webpage](http://www.hotelmama.club). It is possible that this webpage will not be accessible after the end of our project at the University of St. Gallen. However, you can download our flask app and try to run it on your local machine for development and testing purposes.
Check the notes below on how to deploy the project on a live system.
We are encouraging to use it for educational purposes.

### Backend & Application
Here you can see the programs used in the backend as well as the resulting functionalities of the App.
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Model2.PNG?raw=true)

### Frontend
In order to construct an appealing frontend that functions on any device we used these programs.
![alt text](https://github.com/logantypes/DSCS2020-Group-Project/blob/main/README_pictures/Model3.PNG?raw=true)


### Technical Features
Here you can find a more technical description of the Hotel Mama's features.

On the **SQL Database running on GCP** following information are saved:
* Users class includes user data: User-ID, Name, Email, Hashed Password, Products (Posts or Recipes) and Profile Picture
* Products class includes Recipes saved from the users: ID, Name, Description, Price (time it takes to cook the recipe), Tag, post length, sentiment, magnitude of sentiment, language, most popular words in a post, its occurence, date created, post image, likes and user-ID
* Product-Likes class includes all information on the like-function: ID, user-ID and the products-ID
* Food class includes food added to fridge by the users and grocery list of the users: ID, recipe-ID, grocery list, recipe title, date created and user-ID
* Menu class includes menus generated from Hotel Mama: ID, Spoonacular-ID, disht itle, day, slot, date created and user-ID
* Custom class for personalized grocery list of the users: ID, product, date created and user-ID
* Fridge class includes Food added to fridge by the users: ID, product, date created and user-ID

Please notice that for every entry, we refer to the logged-in user. This information is saved in every class under the category of the user_id as a foreign key.

We work with the **Spoonacular API** for the following functionalities:
Weekly Menu creation
Chatbot
Fridge Search
Analytics

Hotel Mama uses the **Foodrepo API** for reading the barcode of the scanned products. The information returned about the product are then entered into the fridge class.

The Number under the Barcode is retrieved from the photo using the **pyzbar** package.

Additionally, we worked also with the following **google cloud products**:  
* Google vision API to recognizes the type of food a user adds to the fridge.
* Natural language API to analyze the recipes posted by the users. The analysis is available for the users under the subpage /analytics
* Data studio for creating the analytics
* Google AutoML to train the model for tagging purposes on our website. The model used food 11 dataset, though not completely, due to economical reasons , 400 images were used for each of the 11 categories for training, validation and evaluation purposes. The custom Google AutoML takes about 32 node hours to fully train the model with a F2 measure of about 96 %.


### Prerequisites
* [Python](https://docs.python.org/3/): Python is used as the backend language for created helper functions, logic, and routes. *(random, sys, os, re, io, string, DateTime, requests)*

* [Flask](http://flask.pocoo.org/): Flask was used as a microframework for constructing the backend.
It also provides useful functions that we could use to help with routing, errors, and messages. *(render_template, redirect, url_for, flash, request)*

  * [Flask-WTForms](https://flask-wtf.readthedocs.io/en/stable/): We implemented Flask-WTF for password hashing.*(Werkzeug, generate_password_hash)*

  * [Flask-Login](https://flask-login.readthedocs.io/en/latest/): We implemented Flask-Login for the user-session management. It is responsible for logging in/out and remembering user's sessions. *(LoginManager, UserMixin, login_user, current_user, logout_user, login_required)*

* [Google Cloud](https://cloud.google.com/): Google cloud was used for the image recognition of the food as well as the barcode recognition for packaged foods and google natural language for the analysis of the recipes. In this way we are able to recognize every type of food. We also used Google data studio for the analytics. *(VM Instance, Vision, Natural Language, Data Studio , as well as AutoML)*

* [Spoonacular](https://spoonacular.com/): The recipes you can retrieve on Hotel Mama are from the Spoonacular API. While developing the App, we bought a basic package to be able to make a greater amount of daily API callings. This is not necessary but keep in mind that you have to authenticate and then insert your API key.

* [Foodrepo](https://www.foodrepo.org/): The barcodes you retrieve on Hotel Mama are from the Foodrepo API. Keep in mind, that the Foodrepo API is focused on Swiss products and might not work perfectly if you implement this application in another country. This is not necessary but keep in mind that you have to authenticate and then insert your API key.


* [SQL](https://www.sqlalchemy.org/): The databases containing all data saved in the classes Users, Products, Product-Likes, Food, Menu, Custom and Fridge with their respective attributes. *(SQLAlchemy)*

* [CSS](https://www.w3.org/Style/CSS/current-work.en.html), [HTML](https://www.w3.org/TR/html52/) and [Bootstrap](https://getbootstrap.com/) were also used for the frontend. Bootstrap was configured to be responsive on all devices, including phones, tablets, laptops and pc .
* [Pytorch](https://pytorch.org/get-started/locally/) Pytorch library is needed for a custom model for training as well as for starting the app with custom machine learning model. For training your own set of tags , you can use Model.ipynb . The CUDA package is required for training of datasets such as food11 or food101 . The custom model was trained with Wideresnet-18 framework due to high learning capabilities as well as adequate use of CUDA memory , however other models as well as data augumentations are possible. 
Google Colab Pro is advised for model training. Machine_Learning.py could be used for testing the newly trained model on your device.


## Installation

>How to launch Hotel Mama on your local repository?

A step by step series of examples that tell you how to get a development environment running

To install the project's dependencies.

```
pip install -r requirements.txt
```

For creating the database, you should register on Google Cloud and create a new instance for the SQL database as well as creating a bucket for Google Storage. Furthermore, you will need to activate the vision API as well as the natural language API by receiving google credentials in json format which you would have to allocate to the gcp_credentials folder.

Additionally, you should register on Spoonacular and get your API_KEY and do the same for the FOODREPO API . (As mentioned Foodrepo works primarily with Swiss food products).

Furthermore, you have to train a machine learning model for tagging classification by picture  or use a custom version provided by us with accuracy of 65 % on food11 dataset. During our project we used food 11 dataset [Webpage](https://www.kaggle.com/trolukovich/food11-image-dataset) , however there is also a possibility to use food 101 dataset. Both of them are publicly accessible via Kaggle . We chose to use food 11 dataset due to economical and time constraint reasons of training the model on Google AutoMl as well as creating a custom model (Model.ipynb) .However , the training could also be performed on your own model with other datasets. To choose between the custom model provided by us or AutoML model , change Custom_Model boolean to True or False at the beginning of main.py . The best checkpoint can be downloaded from a link in link_for_best_checkpoint_custom_model.txt . The checkpoint should be located in the main folder. Due to maximum file size allowance we can't provide checkpoint directly with the whole repository. 

Create your secrets.py file:

```
SQL_PASSWORD = "YOURKEYHERE"
SQL_PUBLIC_IP = "YOURKEYHERE"
SQL_DATABASE_NAME = "YOURKEYHERE"
FOODREPO_KEY = "YOURKEYHERE."
SPOON_KEY= "YOURKEYHERE"
BUCKET_NAME = "YOURKEYHERE"
SECRET_KEY = "YOURKEYHERE"

# AutoML
PROJECT_ID = "YOURKEYHERE"
MODEL_ID = "YOURKEYHERE"
```

Also, notice that at the beginning of main.py, you will need to specify your google application credentials.

Finally, remember to configure your SQL database.

Final notes:

populate_database.py could be used to populate the recipes section of the website with Spoonacular Recipes
db_startup.py is particulary useful when you change the classes or parameters of classes in SQL database to instantiate the database . Sometimes the dependency error appears, but this can be solved with the second part of that file that deletes the old structure in a CASCADE manner.
get-pip.py installs pip on your device if this is necessary

## Major Challenges
Our biggest challenge was to integrate all functionalities in the same App. In the beginning, we worked with few categories for the SQL Database. By adding functionalities, such as saving the weekly menu or scanning the barcode, we needed to modify our classes in the SQL Database. This constant implied that we had to restart the SQL Databaase every time.

Furthermore, when increasing the number of features, we also had to consider all other existing parts that might have been influenced by the change we already made. For example, we wanted to give users the possibility to provide preferences about their diet and calorie intake to create personalized weekly menus. We had to change the menu creator's original function and make a new app route where the personalized menu was showed.

Another point is that we worked with APIs (Spoonacular and Food Repo). We needed to consider the respective documentation to determine how to get the information we wanted for each feature. For example, when creating the specific recipes page, we tried to integrate nutritional values and ingredients.  

To sum up, our primary challenge was to integrate several functionalities and simultaneously keeping in mind how a new feature might have influences other existing functionalities.


## Impressum
This App was developed as an Assignment for the Data Science and Cloud solution course of the University of St.Gallen by our Group members:
* **Artur Dobysh** artur.dobysh@gmail.com +41 78 858 41 55
* **Alessandra Cerutti** [Linkedin](https://www.linkedin.com/in/alessandra-cerutti/)
* **Yannick Hänggi** [Linkedin](https://www.linkedin.com/in/yannick-haenggi/)
* **Julian Shergill** [Linkedin](https://www.linkedin.com/in/julian-s-65a57718b/)

#### Go and Check it out
For this project we run Hotel Mama in a public domain; go and check it out: [Webpage](http://www.hotelmama.club)
However, the domain won't be accessible after the end of the project
#### License
This project is licensed under the MIT License - see the [LICENSE.md](License.md) file for details
